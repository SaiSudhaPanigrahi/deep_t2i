---

title: Deep t2i

keywords: fastai
sidebar: home_sidebar

summary: "My Experients of text to image using deep learning"
description: "My Experients of text to image using deep learning"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li>Generate 256x256 bird image from natural text.</li>
<li>Generate 64x64 anime faces image from specific tags.</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Video">Video<a class="anchor-link" href="#Video"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">I</span> <span class="n">made</span> <span class="n">a</span> <span class="n">explanation</span> <span class="n">video</span> <span class="n">using</span> <span class="n">chinese</span><span class="p">:</span>  

<span class="p">[</span><span class="o">![](</span>http://img.youtube.com/vi/nPzVP1BmRhw/0.jpg<span class="o">)](</span>http://www.youtube.com/watch?v<span class="o">=</span>nPzVP1BmRhw <span class="s2">&quot;&quot;</span><span class="o">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-cyan-fg">  File </span><span class="ansi-green-fg">&#34;&lt;ipython-input-3-83fbffca510c&gt;&#34;</span><span class="ansi-cyan-fg">, line </span><span class="ansi-green-fg">1</span>
<span class="ansi-red-fg">    I made a explanation video using chinese:</span>
         ^
<span class="ansi-red-fg">SyntaxError</span><span class="ansi-red-fg">:</span> invalid syntax
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Training-and-Result">Training and Result<a class="anchor-link" href="#Training-and-Result"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Please check these notebooks which contain the full training process. 
(<a href="nbs/20a_Train_Anime_Heads_DAMSM.ipynb">20a_Train_Anime_Heads_DAMSM.ipynb</a>, <a href="nbs/20b_Train_Anime_Heads_GAN.ipynb">20b_Train_Anime_Heads_GAN.ipynb</a>, <a href="nbs/20c_Train_Birds_DAMSM.ipynb">20c_Train_Birds_DAMSM.ipynb</a>, <a href="nbs/20d_Train_Birds_GAN.ipynb">20d_Train_Birds_GAN.ipynb</a> )</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice that for birds dataset, the results are not always good. The followings are which I choosed that looks good.
{% include image.html height="200" max-width="300" file="/deep_t2i/images/anime_heads_result.jpg" %}
{% include image.html file="/deep_t2i/images/birds_result.jpg" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can check <a href="https://drive.google.com/file/d/1ZtjY0zswy37DDxHV0JvLhawhthP9ae1M/view?usp=sharing">birds_results</a>  or <a href="https://drive.google.com/file/d/1PqbnvfK_aha0Pqge16ETLrr7TqNC-xxM/view?usp=sharing">anime_heads_results</a> to get the result images during training process for each epoch.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data">Data<a class="anchor-link" href="#Data"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Birds:<ul>
<li><a href="http://www.vision.caltech.edu/visipedia/CUB-200-2011.html">CUB-200</a></li>
<li><a href="https://drive.google.com/open?id=1O_LtUP9sch09QH3s_EBAgLEctBQ5JBSJ">Birds Captions from AttnGAN</a></li>
</ul>
</li>
<li>Anime faces<ul>
<li><a href="https://drive.google.com/uc?export=download&amp;id=1tpW7ZVNosXsIAWu8-f5EpwtF3ls3pb79">Simple anime faces data</a></li>
<li>This data is from this <a href="http://speech.ee.ntu.edu.tw/~tlkagk/courses_MLDS18.html">course</a> </li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Model-Architecture">Model Architecture<a class="anchor-link" href="#Model-Architecture"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>DAMSM
{% include image.html height="476" max-width="625" file="/deep_t2i/images/DAMSM_arch.jpg" %}
{% include image.html height="476" max-width="625" file="/deep_t2i/images/DAMSM_train.jpg" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>GAN
{% include image.html height="476" max-width="1248" file="/deep_t2i/images/GAN_arch.jpg" %}
{% include image.html height="476" max-width="625" file="/deep_t2i/images/GAN_train.jpg" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The architecture design is largely inspired by <a href="https://github.com/taoxugit/AttnGAN">Attn-GAN</a>, <a href="https://github.com/akanimax/BMSG-GAN">MSG-GAN</a>, <a href="https://arxiv.org/abs/1805.08318">SA-GAN</a> and <a href="https://arxiv.org/abs/1710.10196">Pro-GAN</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li>Skip connection from MSG-GAN</li>
<li>Attention and DAMSM from AttnGAN, </li>
<li>SelfAtten, Spectral norm, Batch Norm from SAGAN</li>
<li>Architecture and running average of the generator weights from ProGAN but add some residual and attention</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Please check this notebook to get more details of my model architecture. ( <a href="nbs/03a_model.ipynb">03a_model.ipynb</a> )</p>
<p>Check these notebooks to get details of the loss and training. ( <a href="nbs/04a_trainer_DAMSM.ipynb">04a_trainer_DAMSM.ipynb</a>, <a href="nbs/04b_trainer_GAN.ipynb">04b_trainer_GAN.ipynb</a> )</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Pretrained-Model">Pretrained Model<a class="anchor-link" href="#Pretrained-Model"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://drive.google.com/file/d/1pp696JJCD5ng3C7klhHS5Q7_iTKtEpjs/view?usp=sharing">Exported Anime Face Model</a><br>
<a href="https://drive.google.com/file/d/1phNW_utePcz188jDuqRhMYspPXJZNpMT/view?usp=sharing">Exported Birds Model</a></p>
<p>See <a href="nbs/21a_example_inference.ipynb">21a_example_inference.ipynb</a> for inference example</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Flask-Server-and-Simple-Demo-Site">Flask Server and Simple Demo Site<a class="anchor-link" href="#Flask-Server-and-Simple-Demo-Site"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><a href="server">Flask Server</a> that deployed on Google Cloud Run</li>
<li><a href="https://github.com/cwza/deep_t2i_web">Simple Demo Site</a>: Simple web interface for the flask server</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-Develop">How to Develop<a class="anchor-link" href="#How-to-Develop"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Clone this repository</li>
<li>Run <code>make install</code> to install deep_t2i</li>
<li>Data:<ul>
<li>Download <a href="http://www.vision.caltech.edu/visipedia-data/CUB-200-2011/CUB_200_2011.tgz">CUB-200-2011</a> and put it to ./data/full_data/CUB-200-2011.tgz</li>
<li>Download <a href="https://drive.google.com/open?id=1O_LtUP9sch09QH3s_EBAgLEctBQ5JBSJ">Birds Captions from AttnGAN</a>  and put it to ./data/full_data/birds.zip</li>
<li>Download <a href="https://drive.google.com/uc?export=download&amp;id=1tpW7ZVNosXsIAWu8-f5EpwtF3ls3pb79">Simple anime faces data</a> and put it to ./data/full_data/data.zip</li>
<li>Run <code>python3 ./scripts/birds_data.py</code> and <code>python3 ./scripts/anime_heads_data.py</code></li>
</ul>
</li>
<li>Make some change in nbs/xxx.ipynb. You can add documentation in notebooks!!!</li>
<li>Run <code>make build</code> to generate code from jupyter notebooks to ./deep_t2i</li>
<li>Run <code>make test</code> to do some unit test</li>
<li>Run <code>make build-all</code> to also generate documentation from notebooks</li>
<li>Git push</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-Train">How to Train<a class="anchor-link" href="#How-to-Train"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Clone this repository</li>
<li>Run <code>make install</code> to install deep_t2i</li>
<li>Data:<ul>
<li>Download <a href="http://www.vision.caltech.edu/visipedia-data/CUB-200-2011/CUB_200_2011.tgz">CUB-200-2011</a> and put it to ./data/full_data/CUB-200-2011.tgz</li>
<li>Download <a href="https://drive.google.com/open?id=1O_LtUP9sch09QH3s_EBAgLEctBQ5JBSJ">Birds Captions from AttnGAN</a>  and put it to ./data/full_data/birds.zip</li>
<li>Download <a href="https://drive.google.com/uc?export=download&amp;id=1tpW7ZVNosXsIAWu8-f5EpwtF3ls3pb79">Simple anime faces data</a> and put it to ./data/full_data/data.zip</li>
<li>Run <code>python3 ./scripts/birds_data.py</code> and <code>python3 ./scripts/anime_heads_data.py</code></li>
</ul>
</li>
<li>See ./nbs/20c_Train_Birds_DAMSM.ipynb for training DAMSM</li>
<li>See ./nbs/20d_Train_Birds_GAN.ipynb for training and getting exported model</li>
<li>See ./nbs/21a_example_inference.ipynb for inference</li>
</ul>

</div>
</div>
</div>
</div>
 

