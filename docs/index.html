---

title: Deep t2i

keywords: fastai
sidebar: home_sidebar

summary: "My Experients of text to image using deep learning"
description: "My Experients of text to image using deep learning"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Generate 256x256 bird image from natural text.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data">Data<a class="anchor-link" href="#Data"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Main data:</p>
<ul>
<li><a href="http://www.vision.caltech.edu/visipedia/CUB-200-2011.html">CUB-200</a></li>
<li><a href="https://drive.google.com/open?id=1O_LtUP9sch09QH3s_EBAgLEctBQ5JBSJ">Birds Captions from AttnGAN</a></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The files with name "anime_heads" are related to another data. Which is a very simple task that try to generate anime faces from just two factors: hair color and eye color. I just use this data to quickly check the functionality of my model. It should work perfectly with this simple task.</p>
<ul>
<li><a href="https://drive.google.com/uc?export=download&amp;id=1tpW7ZVNosXsIAWu8-f5EpwtF3ls3pb79">Simple anime faces data</a></li>
<li>This data is from this <a href="http://speech.ee.ntu.edu.tw/~tlkagk/courses_MLDS18.html">course</a> </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Model-Architecture">Model Architecture<a class="anchor-link" href="#Model-Architecture"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>DAMSM
{% include image.html height="476" max-width="625" file="/deep_t2i/images/DAMSM_arch.jpg" %}
{% include image.html height="476" max-width="625" file="/deep_t2i/images/DAMSM_train.jpg" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>GAN
{% include image.html height="476" max-width="1248" file="/deep_t2i/images/GAN_arch.jpg" %}
{% include image.html height="476" max-width="625" file="/deep_t2i/images/GAN_train.jpg" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The architecture design is largely inspired by Attn-GAN, MSG-GAN, SA-GAN and Pro-GAN.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li>Skip connection from MSG-GAN</li>
<li>Attention and DAMSM from AttnGAN, </li>
<li>SelfAtten, Spectral norm, Batch Norm from SAGAN</li>
<li>Architecture and ema generator from ProGAN but add some residual and attention</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Please check this notebook to get more details of my model architecture. ( <a href="nbs/03a_model.ipynb">03a_model.ipynb</a> )</p>
<p>Check these notebooks to get details of the loss and training. ( <a href="nbs/04a_trainer_DAMSM.ipynb">04a_trainer_DAMSM.ipynb</a>, <a href="nbs/04b_trainer_GAN.ipynb">04b_trainer_GAN.ipynb</a> )</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Training-and-Result">Training and Result<a class="anchor-link" href="#Training-and-Result"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Please check these notebooks which contain the full training process. 
(<a href="nbs/99c_Train_Birds_DAMSM.ipynb">99a_Train_Anime_Heads_DAMSM.ipynb</a>, <a href="nbs/99d_Train_Birds_GAN.ipynb">99b_Train_Anime_Heads_GAN.ipynb</a>, <a href="nbs/99c_Train_Birds_DAMSM.ipynb">99c_Train_Birds_DAMSM.ipynb</a>, <a href="nbs/99d_Train_Birds_GAN.ipynb">99d_Train_Birds_GAN.ipynb</a> )</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Selected sample results:
{% include image.html height="200" max-width="300" file="/deep_t2i/images/anime_heads_result.jpg" %}
{% include image.html file="/deep_t2i/images/birds_result.jpg" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can check <a href="https://drive.google.com/file/d/1ZtjY0zswy37DDxHV0JvLhawhthP9ae1M/view?usp=sharing">birds_results</a>  or <a href="https://drive.google.com/file/d/1PqbnvfK_aha0Pqge16ETLrr7TqNC-xxM/view?usp=sharing">anime_heads_results</a> to get the result images during training process for each epoch.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Pretrained-Model">Pretrained Model<a class="anchor-link" href="#Pretrained-Model"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://drive.google.com/file/d/1pp696JJCD5ng3C7klhHS5Q7_iTKtEpjs/view?usp=sharing">Exported Anime Face Model</a><br>
<a href="https://drive.google.com/file/d/1phNW_utePcz188jDuqRhMYspPXJZNpMT/view?usp=sharing">Exported Birds Model</a></p>
<p>Use inference_anime_heads module to load these exported models.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Flask-Server-and-Simple-Demo-Site">Flask Server and Simple Demo Site<a class="anchor-link" href="#Flask-Server-and-Simple-Demo-Site"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><a href="server">Flask Server</a></li>
<li><a href="https://github.com/cwza/deep_t2i_web">Demo Site</a></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-Develop">How to Develop<a class="anchor-link" href="#How-to-Develop"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Clone this repository</li>
<li>Run <code>make install</code> to install deep_t2i</li>
<li>Data:<ul>
<li>Download <a href="http://www.vision.caltech.edu/visipedia-data/CUB-200-2011/CUB_200_2011.tgz">CUB-200-2011</a> and put it to ./data/full_data/CUB-200-2011.tgz</li>
<li>Download <a href="https://drive.google.com/open?id=1O_LtUP9sch09QH3s_EBAgLEctBQ5JBSJ">Birds Captions from AttnGAN</a>  and put it to ./data/full_data/birds.zip</li>
<li>Download <a href="https://drive.google.com/uc?export=download&amp;id=1tpW7ZVNosXsIAWu8-f5EpwtF3ls3pb79">Simple anime faces data</a> and put it to ./data/full_data/data.zip</li>
<li>Run <code>python3 ./scripts/birds_data.py</code></li>
</ul>
</li>
<li>Make some change in nbs/xxx.ipynb. You can add documentation in notebooks!!!</li>
<li>Run <code>make build</code> to generate code from jupyter notebooks to ./deep_t2i</li>
<li>Run <code>make test</code> to do some unit test</li>
<li>Run <code>make build-all</code> to also generate documentation from notebooks</li>
<li>Git push</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-Train">How to Train<a class="anchor-link" href="#How-to-Train"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Clone this repository</li>
<li>Run <code>make install</code> to install deep_t2i</li>
<li>Data:<ul>
<li>Download <a href="http://www.vision.caltech.edu/visipedia-data/CUB-200-2011/CUB_200_2011.tgz">CUB-200-2011</a> and put it to ./data/full_data/CUB-200-2011.tgz</li>
<li>Download <a href="https://drive.google.com/open?id=1O_LtUP9sch09QH3s_EBAgLEctBQ5JBSJ">Birds Captions from AttnGAN</a>  and put it to ./data/full_data/birds.zip</li>
<li>Download <a href="https://drive.google.com/uc?export=download&amp;id=1tpW7ZVNosXsIAWu8-f5EpwtF3ls3pb79">Simple anime faces data</a> and put it to ./data/full_data/data.zip</li>
<li>Run <code>python3 ./scripts/birds_data.py</code></li>
</ul>
</li>
<li>See ./nbs/99c_Train_Birds_DAMSM.ipynb for training DAMSM</li>
<li>See ./nbs/99d_Train_Birds_GAN.ipynb for training and getting exported model</li>
<li>See ./nbs/05b_inference_birds.ipynb for inference</li>
</ul>

</div>
</div>
</div>
</div>
 

